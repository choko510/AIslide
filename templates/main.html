<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIslide - ダッシュボード</title>
    <link rel="stylesheet" href="{{ url_for('static', path='style.css') }}">
    <link rel="stylesheet" href="https://site-assets.fontawesome.com/releases/v6.7.2/css/all.css">
</head>

<body class="page-transition">

    <div class="dashboard-container">
        <aside class="sidebar">
            <h1>AIslide</h1>
            <button class="create-new-btn" id="create-new-slide-btn">
                <i class="fas fa-plus"></i>
                <span>新しいプレゼンテーション</span>
            </button>
            <!-- 他のメニュー項目をここに追加可能 -->
        </aside>

        <main class="main-content">
            <header class="header">
                <div id="auth-area">
                    <!-- 認証状態に応じてJSで内容を切り替え -->
                </div>
            </header>
            <div class="content-area">
                <h2>あなたのプレゼンテーション</h2>
                <div class="slide-list" id="slide-list">
                    <!-- スライドはJSで動的に追加されます -->
                </div>
            </div>
        </main>
    </div>

    <!-- Login Modal -->
    <div id="login-modal" class="modal">
        <div class="modal-content">
            <h2>ログイン</h2>
            <form id="login-form">
                <input type="text" id="login-username" placeholder="ユーザー名" required>
                <input type="password" id="login-password" placeholder="パスワード" required>
                <button type="submit">ログイン</button>
            </form>
            <div class="modal-switch">
                アカウントをお持ちでないですか？ <a id="show-register-modal">新規登録</a>
            </div>
        </div>
    </div>

    <!-- Register Modal -->
    <div id="register-modal" class="modal">
        <div class="modal-content">
            <h2>新規登録</h2>
            <form id="register-form">
                <input type="text" id="register-username" placeholder="ユーザー名" required>
                <input type="password" id="register-password" placeholder="パスワード" required>
                <button type="submit">登録</button>
            </form>
            <div class="modal-switch">
                アカウントをお持ちですか？ <a id="show-login-modal">ログイン</a>
            </div>
        </div>
    </div>

    <!-- Custom Alert -->
    <div id="custom-alert" class="custom-alert">
        <div class="alert-content">
            <i id="alert-icon" class="alert-icon"></i>
            <div id="alert-title" class="alert-title"></div>
            <div id="alert-message" class="alert-message"></div>
            <div class="alert-buttons">
                <button id="alert-ok-btn" class="alert-button primary">OK</button>
                <button id="alert-cancel-btn" class="alert-button secondary" style="display: none;">キャンセル</button>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settings-modal" class="modal">
        <div class="modal-content">
            <h2>設定</h2>
            <div class="settings-section">
                <label for="settings-language-select">言語 / Language:</label>
                <select id="settings-language-select">
                    <option value="ja">日本語</option>
                    <option value="en">English</option>
                </select>
            </div>

            <div class="settings-section">
                <label for="settings-theme-select">テーマ / Theme:</label>
                <select id="settings-theme-select">
                    <option value="light">ライト / Light</option>
                    <option value="dark">ダーク / Dark</option>
                </select>
            </div>

            <div class="settings-buttons">
                <button id="settings-save-btn" class="settings-button primary">保存 / Save</button>
                <button id="settings-cancel-btn" class="settings-button secondary">キャンセル / Cancel</button>
            </div>
        </div>
    </div>

    <!-- Choice Modal: 新しいプレゼンテーションの作成方法選択 -->
    <div id="new-presentation-modal" class="modal">
        <div class="modal-content new-presentation">
            <button class="modal-close" id="new-presentation-cancel" aria-label="閉じる">
                <i class="fas fa-times"></i>
            </button>
            <h2 class="modal-title">作成方法を選択</h2>
            <p class="modal-subtitle">どちらの方法で始めますか？後から内容は編集できます。</p>

            <div class="choice-grid">
                <!-- plan 遷移はアニメーションしたいので data-no-transition は付けない -->
                <button id="create-with-ai" class="choice-card primary" data-transition="fade" data-href="/plan/">
                    <div class="choice-icon">
                        <i class="fas fa-wand-magic-sparkles"></i>
                    </div>
                    <div class="choice-text">
                        <div class="choice-title">AIで作成</div>
                        <div class="choice-desc">トピックや目的を入力すると、AIがアウトラインを作成します</div>
                    </div>
                </button>

                <button id="create-from-scratch" class="choice-card">
                    <div class="choice-icon">
                        <i class="fas fa-pen-to-square"></i>
                    </div>
                    <div class="choice-text">
                        <div class="choice-title">0から作成</div>
                        <div class="choice-desc">空のプレゼンテーションから自由に作り始めます</div>
                    </div>
                </button>
            </div>

            <div class="modal-actions">
                <button class="ghost-btn" id="new-presentation-cancel-footer">キャンセル</button>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toast-container" class="toast-container"></div>

    <script type="module" src="{{ url_for('static', path='app.js') }}"></script>
    <script>
        // フォールバック: 直接 window.location.href 代入を避け、クリックで a による通常遷移に変更
        // これにより app.js のグローバルクリックハンドラが離脱アニメーションを適用可能
        document.addEventListener('DOMContentLoaded', () => {
            const btn = document.getElementById('create-with-ai');
            if (btn) {
                // 先に <link rel="prefetch"> ヒントを付与（ブラウザ依存、効果がある場合は先読みされる）
                const hint = document.createElement('link');
                hint.rel = 'prefetch';
                hint.href = '/plan/';
                hint.as = 'document';
                document.head.appendChild(hint);

                btn.addEventListener('click', (e) => {
                    e.preventDefault();
                    // 動的に a 要素を作成してクリック（通常のナビゲーションにする）
                    const a = document.createElement('a');
                    a.href = '/plan/';
                    document.body.appendChild(a);
                    a.click();
                    a.remove();
                });
            }
        });
    </script>
    <style>
        /* New Presentation Modal Enhancements */
        .modal .modal-content.new-presentation {
            position: relative;
            width: min(640px, 92vw);
            padding: 28px 24px 20px;
            border-radius: 14px;
            box-shadow: 0 20px 50px rgba(0, 0, 0, .25);
        }

        .modal .modal-content.new-presentation .modal-title {
            margin: 6px 0 4px;
            font-size: 22px;
            font-weight: 700;
            text-align: center;
        }

        .modal .modal-content.new-presentation .modal-subtitle {
            margin: 0 0 16px;
            color: var(--text-muted, #667085);
            font-size: 13px;
            text-align: center;
        }

        .modal .modal-content.new-presentation .modal-close {
            position: absolute;
            right: 12px;
            top: 12px;
            width: 36px;
            height: 36px;
            border-radius: 10px;
            border: 1px solid var(--border-color, #e5e7eb);
            background: var(--bg, #fff);
            display: grid;
            place-items: center;
            color: #6b7280;
            transition: all .15s ease;
        }

        .modal .modal-content.new-presentation .modal-close:hover {
            background: #f3f4f6;
            color: #111827;
        }

        .choice-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 14px;
            margin: 6px 0 6px;
        }

        @media (max-width: 520px) {
            .choice-grid {
                grid-template-columns: 1fr;
            }
        }

        .choice-card {
            display: grid;
            grid-template-columns: 48px 1fr;
            align-items: center;
            gap: 12px;
            padding: 14px;
            border-radius: 12px;
            background: var(--surface, #fff);
            border: 1px solid var(--border-color, #e5e7eb);
            cursor: pointer;
            text-align: left;
            transition: transform .08s ease, box-shadow .2s ease, border-color .2s ease, background .2s ease;
        }

        .choice-card:hover {
            transform: translateY(-1px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, .08);
            border-color: #cbd5e1;
            background: #f9fafb;
        }

        .choice-card.primary {
            background: #eef2ff;
            border-color: #c7d2fe;
        }

        .choice-card.primary:hover {
            background: #e0e7ff;
            border-color: #a5b4fc;
        }

        .choice-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: grid;
            place-items: center;
            color: #1f6feb;
            background: #e8f1ff;
            font-size: 20px;
        }

        .choice-card.primary .choice-icon {
            color: #6d28d9;
            background: #f0e9ff;
        }

        .choice-title {
            font-weight: 700;
            font-size: 15px;
            margin-bottom: 4px;
            color: var(--text, #111827);
        }

        .choice-desc {
            font-size: 12px;
            color: #6b7280;
        }

        .modal-actions {
            margin-top: 14px;
            display: flex;
            justify-content: center;
        }

        .ghost-btn {
            padding: 10px 14px;
            border-radius: 10px;
            border: 1px solid var(--border-color, #e5e7eb);
            background: #fff;
            color: #374151;
            font-size: 14px;
            transition: background .15s ease, color .15s ease, border-color .15s ease;
        }

        .ghost-btn:hover {
            background: #f3f4f6;
            border-color: #d1d5db;
            color: #111827;
        }
    </style>
</body>

</html>